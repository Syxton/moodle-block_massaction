define("block_massaction/checkboxmanager",["exports","core/templates","core/notification","./massactionblock"],(function(_exports,_templates,_notification,_massactionblock){var obj;
/**
   * Checkbox manager amd module: Adds checkboxes to the activities for selecting and
   * generates a data structure of the activities and checkboxes.
   *
   * @module     block_massaction/checkboxmanager
   * @copyright  2022 ISB Bayern
   * @author     Philipp Memmel
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};var sectionBoxes={},addCheckboxes=function(sections,moduleNames){sections.forEach((function(section){sectionBoxes[section.number]=[];var moduleIds=section.modules.split(",");moduleIds&&moduleIds.length>0&&""!==moduleIds[0]&&moduleNames.filter((function(modinfo){return moduleIds.includes(modinfo.modid.toString())})).forEach((function(modinfo){addCheckboxToModule(section.number,modinfo.modid.toString(),modinfo.name)}))}))},addCheckboxToModule=function(sectionNumber,moduleId,moduleName){var boxId=_massactionblock.cssIds.BOX_ID_PREFIX+moduleId,moduleElement=document.getElementById(_massactionblock.usedMoodleCssClasses.MODULE_ID_PREFIX+moduleId);if(null===document.getElementById(boxId)){var checkBoxElement=document.createElement("input");if(checkBoxElement.type="checkbox",checkBoxElement.className=_massactionblock.cssIds.CHECKBOX_CLASS,checkBoxElement.id=boxId,null!==moduleElement){var checkboxDescription=moduleName+_massactionblock.constants.CHECKBOX_DESCRIPTION_SUFFIX;checkBoxElement.ariaLabel=checkboxDescription,checkBoxElement.name=checkboxDescription,moduleElement.insertBefore(checkBoxElement,moduleElement.firstChild)}}sectionBoxes[sectionNumber].push({moduleId:moduleId,boxId:boxId})},filterVisibleSections=function(sections){return sections.filter((function(section){return section.modules.split(",").every((function(moduleid){return null!==document.getElementById(_massactionblock.usedMoodleCssClasses.MODULE_ID_PREFIX+moduleid)}))}))},updateSelectionAndMoveToDropdowns=function(sections,sectionsUnfiltered){var sectionNamesInSelect=Array.prototype.map.call(document.getElementById(_massactionblock.cssIds.SECTION_SELECT).options,(function(option){return option.text}));sectionNamesInSelect.shift(),JSON.stringify(sectionsUnfiltered.map((function(section){return section.name})))!==JSON.stringify(sectionNamesInSelect)?(_templates.default.renderForPromise("block_massaction/section_select",{sections:sectionsUnfiltered}).then((function(_ref){var html=_ref.html,js=_ref.js;return _templates.default.replaceNode("#"+_massactionblock.cssIds.SECTION_SELECT,html,js),disableInvisibleAndEmptySections(sections),document.getElementById(_massactionblock.cssIds.SECTION_SELECT).addEventListener("click",(function(event){return(0,_massactionblock.setSectionSelection)(!0,event.target.value)}),!1),!0})).catch((function(ex){return(0,_notification.exception)(ex)})),_templates.default.renderForPromise("block_massaction/moveto_select",{sections:sectionsUnfiltered}).then((function(_ref2){var html=_ref2.html,js=_ref2.js;return _templates.default.replaceNode("#"+_massactionblock.cssIds.MOVETO_SELECT,html,js),!0})).catch((function(ex){return(0,_notification.exception)(ex)})),_templates.default.renderForPromise("block_massaction/duplicateto_select",{sections:sectionsUnfiltered}).then((function(_ref3){var html=_ref3.html,js=_ref3.js;return _templates.default.replaceNode("#"+_massactionblock.cssIds.DUPLICATETO_SELECT,html,js),!0})).catch((function(ex){return(0,_notification.exception)(ex)}))):disableInvisibleAndEmptySections(sections)},disableInvisibleAndEmptySections=function(sections){Array.prototype.forEach.call(document.getElementById(_massactionblock.cssIds.SECTION_SELECT).options,(function(option){option.value===_massactionblock.constants.SECTION_SELECT_DESCRIPTION_VALUE||sections.some((function(section){return parseInt(option.value)===section.number}))?option.disabled=!1:option.disabled=!0}))},_default=function(sections,moduleNames){var sectionsUnfiltered=sections;return sections=filterVisibleSections(sections),updateSelectionAndMoveToDropdowns(sections,sectionsUnfiltered),addCheckboxes(sections,moduleNames),sectionBoxes};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=checkboxmanager.min.js.map